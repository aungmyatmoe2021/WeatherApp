<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"  rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
    <link rel="shortcut icon" href="#" />
    <title>Weather App</title>
</head>
<body>
  <section class="vh-10" style="background-color: #cdc4f9;">
    <div class="container py-5 h-10">
      <div class="row d-flex justify-content-center align-items-center h-10">
        <div class="col-md-12 col-xl-10">
  
          <div class="card shadow-0 border border-dark border-5 text-dark" style="border-radius: 10px;">
            <div class="card-body p-4">

                <div class="d-flex justify-content-center">
                  <div class="input-group w-auto">
                      <input type="text" id="txtPostCode" class="form-control" name="txtPostCode" placeholder="UK Post Code" style="border-radius: 10px;margin: 2px;"/>
                      <button data-mdb-button-init data-mdb-ripple-init class="btn btn-primary" type="button" id="btnCheckWeather" data-mdb-ripple-color="dark" style="border-radius: 10px;margin: 2px;">
                          Check Weather
                      </button>
                      <button data-mdb-button-init data-mdb-ripple-init class="btn btn-secondary" type="button" id="btnDefaultLocation" data-mdb-ripple-color="dark" style="border-radius: 10px;margin: 2px;">
                        Check Default Location Weather
                    </button>
                  </div>
              </div>
  
            </div>
          </div>
  
        </div>
      </div>
    </div>
  </section>

    <section class="vh-100" style="background-color: #cdc4f9;">
        <div class="container py-5 h-100">
          <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-md-12 col-xl-10">
      
              <div class="card shadow-0 border border-dark border-5 text-dark" style="border-radius: 10px;">
                <div class="card-body p-4">

                    <!-- <div class="d-flex justify-content-center">
                      <div class="input-group w-auto">
                          <input type="text" id="txtPostCode" class="form-control" name="txtPostCode" placeholder="Post Code" style="border-radius: 10px;margin: 2px;"/>
                          <button data-mdb-button-init data-mdb-ripple-init class="btn btn-primary" type="button" id="btnCheckWeather" data-mdb-ripple-color="dark" style="border-radius: 10px;margin: 2px;">
                              Check Weather
                          </button>
                          <button data-mdb-button-init data-mdb-ripple-init class="btn btn-secondary" type="button" id="btnDefaultLocation" data-mdb-ripple-color="dark" style="border-radius: 10px;margin: 2px;">
                            Check Default Location Weather
                        </button>
                      </div>
                  </div> -->
      
                  <div class="row text-center">
                    <div class="col-md-9 text-center border-end border-5 border-dark py-4"
                      style="margin-top: -1.5rem; margin-bottom: -1.5rem;">
                      <div class="d-flex justify-content-around mt-3">
                        <!-- <p class="small">Toronto</p> -->
                        <p class="small" id="currentDate">21.02.2021</p>
                        <!-- <p class="small">Rain map</p> -->
                      </div>
                      <div class="d-flex justify-content-around align-items-center py-5 my-4">
                        <p class="fw-bold mb-0" style="font-size: 7rem;" id="currentTemperature">-4°C</p>
                        <div class="text-start">
                          <p class="small" id="currentTime">10:00</p>
                          <p class="h3 mb-3" id="currentDay">Sunday</p>
                          <p class="small mb-0" id="currentWeather">Cloudy</p>
                        </div>
                      </div>
                      <div class="d-flex justify-content-around align-items-center mb-3">
                        <div class="flex-column">
                          <i class="fas fa-minus"></i>
                        </div>
                        <div class="flex-column border" style="border-radius: 10px; padding: .75rem">
                          <p class="small mb-1"></p>
                          <p class="small mb-0"><strong></strong></p>
                        </div>
                        <div class="flex-column">
                          <p class="small mb-1"></p>
                          <p class="small mb-0"><strong></strong></p>
                        </div>
                        <div class="flex-column">
                          <p class="small mb-1"></p>
                          <p class="small mb-0"><strong></strong></p>
                        </div>
                        <div class="flex-column">
                          <p class="small mb-1"></p>
                          <p class="small mb-0"><strong></strong></p>
                        </div>
                        <div class="flex-column">
                          <p class="small mb-1"></p>
                          <p class="small mb-0"><strong></strong></p>
                        </div>
                        <div class="flex-column">
                          <p class="small mb-1"></p>
                          <p class="small mb-0"><strong></strong></p>
                        </div>
                        <div class="flex-column">
                          <p class="small mb-1"></p>
                          <p class="small mb-0"><strong></strong></p>
                        </div>
                        <div class="flex-column">
                          <i class="fas fa-minus"></i>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3 text-end" id="divResult">
                    </div>
                    
                    <div class="col-md-3 text-end" id="divResult">
                    </div>
                  </div>
      
                </div>
              </div>
      
            </div>
          </div>
        </div>
      </section>


     <!-- <table id="tblResult">
        <tr id="trResult"></tr>
     </table> -->

    <script>
        const now = new Date();
        const date = getDate(now.getDate());
        const month = getMonth(now.getMonth()+1);
        const year = now.getFullYear();
        const hour = now.getHours();
        const minute = now.getMinutes();
        const day = getDay(now.getDay());
        
        $(document).ready(function(){
          getLocation();
        });

        $("#btnDefaultLocation").click(function(){
          getLocation();
        });

        $("#btnCheckWeather").click(function(){
          getLocationByPostCode($("#txtPostCode").val());
        });

        function getLocationByPostCode(postcode){
          $.ajax({
                type: 'GET',
                dataType : 'json',
                url : `https://api.postcodes.io/postcodes/${postcode}`,
                success: function(data,status,xhr){
                  var latitude = data['result']['latitude'];
                  var longitude = data['result']['longitude'];
                  getTemperatureByLocation(latitude,longitude);
                }
            })
        }

        function getLocation(){
          if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(success,error);
            }else{
                $("#demo").html("Geolocation is not supported by this browser.");
            }
            $("#currentDate").html(`${date}-${month}-${year}`);
            $("#currentTime").html(`${hour}:${minute}`);
            $("#currentDay").html(`${day}`);
        }

        function getDate(date){
            if(date < 10){
                return `0${date}`;
            }
            return date;
        }

        function getMonth(month){
            if(month < 10){
                return `0${month}`;
            }
            return month;
        }

        function getDay(day){
            switch(day){
                case 1 :
                    return "Monday";
                    break;
                case 2 :
                    return "Tuesday";
                    break;
                case 3 :
                    return "Wednesday";
                    break;
                case 4 :
                    return "Thursday";
                    break;
                case 5 :
                    return "Friday";
                    break;
                case 6 :
                    return "Saturday";
                    break;
                case 7 :
                    return "Sunday";
                    break;
            }
        }

        function getTemperatureByLocation(latitude,longitude){
          getTemperature(latitude,longitude)
        }

        function success(position){
          latitude = position.coords.latitude;
          longitude = position.coords.longitude ;
          getTemperature(latitude,longitude)
        }

      function getTemperature(latitude,longitude){
        $.ajax({
                type: 'GET',
                dataType : 'json',
                url : `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m,cloud_cover&current=cloud_cover&start_date=${year}-${month}-${date}&end_date=${year}-${month}-${date}`,
                success: function(data,status,xhr){
                    // $("#demo").html(data);
                    // console.log(data);
                    var hourlyRange = data['hourly']['time'];
                    var temperaturRange = data['hourly']['temperature_2m'];
                    if(data['current']['cloud_cover'] < 50){
                        var cloudlevel = "Sunny";
                    }else if(data['current']['cloud_cover'] >= 50 && data['current']['cloud_cover'] < 80){
                        var cloudlevel = "Cloudy";
                    }else if(data['current']['cloud_cover'] >= 80){
                        var cloudlevel = "Most Cloudy";
                    }
                    $("#currentWeather").html(cloudlevel);
                    $('#divResult').html("");
                    var result = "";
                    for(var i=hour;i<hourlyRange.length;i++){
                        $('#divResult').append(`<p class="pb-1"><span class="pe-2">${hourlyRange[i].substring(11,13)}:00</span> ${temperaturRange[i]} <strong></strong>`);
                        if(i==hour){
                            $("#currentTemperature").html(`${temperaturRange[i]} °C`);
                        }
                        
                    }
                }
            });
      }

        function error(){
            alert("Sorry, no position available.");
        }
    </script>
</body>
</html>